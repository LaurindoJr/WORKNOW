{% extends "layout.html" %}{% block content %}
<p><a href="{{ url_for('index') }}">← Voltar</a></p>
<h2>{{ book.title }} ({{ book.code }})</h2>
<p><b>Autor:</b> {{ book.author }}</p>
<p>{{ book.summary or '' }}</p>

{% if status and status.thumbnail_key %}
  <img src="https://{{bucket}}.s3.amazonaws.com/{{status.thumbnail_key}}" style="height:150px">
{% elif book.image_key %}
  <p>Processando imagem…</p>
{% endif %}

<p><a class="button" href="{{ url_for('edit_book', book_id=book.id) }}">Editar</a></p>

<h3>Aluguéis</h3>
<form method="post" action="{{ url_for('rent_book', book_id=book.id) }}">
  <label>Locatário <input name="renter" required></label>
  <button class="primary">Alugar</button>
</form>

<table>
  <thead><tr><th>ID</th><th>Locatário</th><th>Início</th><th>Fim</th><th>Status</th><th></th></tr></thead>
  <tbody>
  {% for r in rentals %}
  <tr>
    <td>{{ r.id }}</td>
    <td>{{ r.renter }}</td>
    <td>{{ r.start_date }}</td>
    <td>{{ r.end_date or '—' }}</td>
    <td>{{ r.status }}</td>
    <td>
      {% if r.status == 'OPEN' %}
      <form method="post" action="{{ url_for('return_rental', rental_id=r.id) }}">
        <button>Devolver</button>
      </form>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
