{% extends "layout.html" %}
{% block content %}
<a href="{{ url_for('index') }}" class="btn btn-link mb-2">← Voltar</a>

<div class="card shadow-sm">
  <div class="card-body">
    <div class="d-flex justify-content-between">
      <h2>{{ book.title }} <small class="text-muted">({{ book.code }})</small></h2>
      <a href="{{ url_for('edit_book', book_id=book.id) }}" class="btn btn-warning">Editar</a>
    </div>

    <p><strong>Autor:</strong> {{ book.author }}</p>
    <p>{{ book.summary or '' }}</p>

    {% if thumb_url %}
    <img src="{{ thumb_url }}" class="img-thumbnail mb-3" style="max-height:200px" alt="thumb {{ book.title }}">
    {% elif book.image_key %}
    <p><em>Processando imagem…</em></p>
    {% endif %}
  </div>
</div>

<h3 class="mt-4">Aluguéis</h3>

<form method="post" action="{{ url_for('rent_book', book_id=book.id) }}" class="row g-2 mb-3">
  <div class="col-md-4">
    <input name="renter" class="form-control" placeholder="Locatário" required>
  </div>
  <div class="col-auto">
    <button class="btn btn-primary">Alugar</button>
  </div>
</form>

<div class="table-responsive">
  <table class="table table-bordered align-middle text-center">
    <thead class="table-secondary">
      <tr>
        <th>ID</th><th>Locatário</th><th>Início</th><th>Fim</th><th>Status</th><th>Ações</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rentals %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.renter }}</td>
        <td>{{ r.start_date }}</td>
        <td>{{ r.end_date or '—' }}</td>
        <td>{{ r.status }}</td>
        <td>
          {% if r.status == 'OPEN' %}
          <form method="post" action="{{ url_for('return_rental', rental_id=r.id) }}">
            <button class="btn btn-sm btn-success">Devolver</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

